formatVersion: 1
inputs: {}
resources:
  Cloud_Machine_1:
    type: Cloud.Machine
    properties:
      image: OAI-Base-Image
      flavor: OAI-R4-Medium
      tags:
        - key: ansible
          value: 'yes'
      remoteAccess:
        authentication: keyPairName
        keyPair: ansible-host      
      constraints:
#        - tag: 'cloud:vsphere'
        - tag: 'cloud:aws'
#        - tag: 'cloud:azure'
#        - tag: 'primary' 
      cloudConfig: |
        runcmd:
#          - apt-get update -y 
          - sudo ssh-import-id-gh moffzilla 
  Ansible:
    type: Cloud.Ansible
    properties:
      inventoryFile: /etc/ansible/hosts
      username: ubuntu
      playbooks:
        provision:
          - /home/ubuntu/playbooks/nginx-playbook.yml
      osType: linux
      groups:
        - GroupName
      maxConnectionRetries: 10
      host: '${resource.Cloud_Machine_1.*}'
      account: ubuntu
      privateKeyFile: ~/.ssh/id_rsa